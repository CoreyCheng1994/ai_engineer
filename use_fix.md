---
description: 识别代码改动并归档文档
---
---
details: 用于识别代码改动范围，并将相关文档归档保存。默认归档当前 spec 文档，也可以指定归档文件。
---

# Use Fix Prompt（代码改动识别与文档归档）

## 一、User Input

```text
1. 加载以下提示词文档（按顺序，遵循 doc_loader.md 规则）：
   - ${old_base}

2. 我将提供一个代码改动任务，需要你：
   - 识别本次改动涉及的代码文件
   - 识别改动的影响范围
   - 归档相关文档（默认归档当前 spec 文档，可指定归档文件）

   $ARGUMENTS
```

---

## 二、总体目标

- 准确识别代码改动范围
- 识别改动的影响范围（功能、模块、依赖关系）
- 归档相关文档，确保文档与代码同步
- 提供清晰的改动摘要

---

## 三、执行流程（强制）

### 3.1 阶段一：代码改动识别

#### 3.1.1 Git 状态检查

* 检查当前 Git 状态：
  * 查看已修改的文件（`git status`）
  * 查看未提交的改动（`git diff`）
  * 查看已提交但未推送的改动（`git log`）

#### 3.1.2 改动文件分析

* 对每个改动的文件：
  * 识别文件类型（前端/后端/配置/文档等）
  * 识别改动类型（新增/修改/删除）
  * 分析改动内容（功能变更/修复/重构等）
  * 识别影响的模块和功能

#### 3.1.3 影响范围分析

* 分析改动的影响范围：
  * 直接影响：直接修改的文件和功能
  * 间接影响：依赖关系、调用链、数据流
  * 潜在影响：可能受影响的其他模块

#### 3.1.4 输出：代码改动识别报告（写入 framework.md）

```markdown
## 代码改动识别

### 1. Git 状态
- 当前分支：
- 改动文件数量：
- 改动类型：新增 / 修改 / 删除

### 2. 改动文件清单
#### 文件 1：{file_path}
- 改动类型：新增 / 修改 / 删除
- 改动摘要：
- 影响模块：
- 影响功能：

#### 文件 2：{file_path}
...

### 3. 影响范围分析
#### 直接影响
- 模块：
- 功能：
- API 接口（如有）：[OpenAPI: {file_path}#/{operationId}]

#### 间接影响
- 依赖模块：
- 调用链：
- 数据流：

#### 潜在影响
- 可能受影响的模块：
- 风险评估：
```

---

### 3.2 阶段二：文档归档

#### 3.2.1 识别相关文档

* 根据代码改动识别相关文档：
  * spec 文档（需求文档）
  * API 文档（OpenAPI 规范）
  * 设计文档
  * 测试文档
  * 其他相关文档

#### 3.2.2 归档策略

* **默认归档**：
  * 归档当前工作目录下的 `spec.md` 文件
  * 若存在 `mydoc/{date}-{taskname}/spec.md`，归档该文件
* **指定归档**：
  * 若用户指定了归档文件路径，归档指定文件
  * 支持归档多个文件

#### 3.2.3 归档操作

* 创建归档目录：
  * 路径：`./mydoc/{date}-{taskname}/archive/`
  * 若目录不存在，自动创建
* 归档文件：
  * 复制文档文件到归档目录
  * 保留原始文件路径结构
  * 文件名格式：`{original_name}-{timestamp}.md`
* 记录归档信息：
  * 归档时间
  * 归档原因（代码改动摘要）
  * 关联的代码改动文件

#### 3.2.4 输出：文档归档记录（写入 framework.md）

```markdown
## 文档归档记录

### 1. 归档时间
- 归档日期：
- 归档原因：代码改动识别与同步

### 2. 归档文件清单
#### 文件 1：{original_path}
- 归档路径：`./mydoc/{date}-{taskname}/archive/{original_name}-{timestamp}.md`
- 归档原因：
- 关联代码改动：

#### 文件 2：{original_path}
...

### 3. 归档摘要
- 归档文件总数：
- 归档文档类型：
- 关联改动范围：
```

---

### 3.3 阶段三：改动摘要生成

#### 3.3.1 生成改动摘要

* 汇总所有改动信息：
  * 改动文件列表
  * 改动类型统计
  * 影响范围总结
  * 归档文档清单

#### 3.3.2 输出：改动摘要（写入 framework.md）

```markdown
## 改动摘要

### 1. 改动统计
- 改动文件总数：
- 新增文件数：
- 修改文件数：
- 删除文件数：

### 2. 改动范围
- 影响模块：
- 影响功能：
- API 接口变更（如有）：

### 3. 文档归档
- 归档文件数：
- 归档路径：`./mydoc/{date}-{taskname}/archive/`

### 4. 后续建议
- 是否需要更新相关文档：
- 是否需要补充测试：
- 是否需要更新 OpenAPI 规范：
```

---

## 四、执行规则（强制）

* 必须使用 Git 命令识别代码改动
* 必须分析改动的影响范围
* 必须归档相关文档
* 归档操作必须保留原始文件
* 归档信息必须记录在 framework.md 中

---

## 五、输出要求（真实落盘）

所有分析与归档必须真实写入 当前目录，文档结构遵循：

```text
./mydoc/
├── catalog.md
└── {date}-{taskname}/
    ├── framework.md   # 代码改动识别 / 文档归档记录 / 改动摘要
    ├── task.md       # 如有任务拆解
    └── archive/      # 归档文档目录
        ├── spec-{timestamp}.md
        └── ...
```

---

## 六、使用示例

### 示例 1：默认归档当前 spec 文档

```text
请使用 use_fix 流程识别代码改动并归档文档
```

### 示例 2：指定归档文件

```text
请使用 use_fix 流程识别代码改动并归档以下文档：
- ./mydoc/2024-01-01-feature/spec.md
- ./docs/api/openapi.yaml
```

---

## 七、成功判定标准

use_fix 流程被视为成功，必须满足：

- 准确识别所有代码改动
- 正确分析改动影响范围
- 成功归档相关文档
- 归档信息完整记录
- 改动摘要清晰可读

