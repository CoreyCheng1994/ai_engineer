---
description: 基于长 prompt 生成项目级“宪法”（技术栈 / 目录 / 项目级补充规则）
---
---
details: 用于一次性梳理项目级别的约束与约定，生成“宪法”文档，并在必要时落盘项目级规则文件，补充现有工作流。
---

# Project Constitution Prompt（init）

## 一、User Input

```text
1. 加载以下提示词文档（按顺序，遵循 doc_loader.md 规则）：
   - ${old_base}
   - ${new_base}
   - ${data_rule}

2. 我将提供一段长 prompt，描述项目的技术栈、目录结构、工程约束、协作偏好等。

3. 请基于上述输入，生成项目级“宪法”文档，并在需要时生成/更新项目级规则文件：

   $ARGUMENTS
```

## 二、目标

- 将长 prompt 中的项目信息固化为可执行的“宪法”文档
- 明确技术栈、目录结构、编码/测试/部署等项目级约束
- 根据需要生成项目级规则文件（如覆盖默认 codestyle/data_rule 等），避免散落在个人偏好
- 为后续工作流提供可引用的统一约束入口

---

## 三、执行步骤

1) 信息提取  
   - 从长 prompt 提取：技术栈、运行环境、目录规划、依赖管理、CI/CD、数据与迁移策略、可观测性、安全/合规、协作约定（分支、提交、PR、评审）、测试策略（包含 E2E：chrome MCP server 优先 + 单测要求）等。
   - 标注：事实 / 推断 / 假设；不明确处提出澄清问题（最多 5 个）。

2) 宪法文档生成  
   - 生成 `constitution.md`，包含：
     - 项目概览与目标
     - 技术栈与关键依赖（版本约束）
     - 目录结构（约定的根目录、子模块、放置规则）
     - 代码规范与可测试性要求（可引用/覆盖 codestyle）
     - 数据与迁移（引用 data_rule，如有定制则写明差异）
     - 接口契约（OpenAPI/GraphQL/proto/事件等真源约定；OpenAPI 作为唯一真源为可选项，需在宪法中明确）
     - 安全、合规、隐私要求（如输入中有）
     - 构建与发布流程（含 CI/CD 基线）
     - 可观测性与回滚策略（feature flag、双写/比对、日志/指标关注点）
     - 分支/提交/PR 规范与审批角色
     - 测试准入：主流程 E2E（chrome MCP server 优先）+ 全部单元测试通过为默认通过线
     - 未决问题列表

3) 项目级规则文件（按需生成/覆盖）  
   - 如长 prompt 定义了与默认不同的规则，可生成/更新项目级文件（例如 `codestyle`、`data_rule` 衍生版、其他专用规则），须明确：
     - 文件名与路径
     - 相比默认规则的差异
     - 适用范围与优先级
   - 若无必要变更，保持默认文件并在宪法中引用现有路径。

4) 输出与落盘  
   - 宪法文档：写入 `./constitution.md`
   - 项目级规则文件（若生成/更新）：写入仓库内约定位置（需在宪法中记录路径与用途）

5) 澄清与暂停规则  
   - 若缺少关键输入（技术栈、目录约定、CI/CD、数据策略等）或存在潜在破坏性决策，需暂停并提出澄清问题后再继续

---

## 四、宪法文档模板（参考，可按需裁剪）

```markdown
# Project Constitution

## 0. 元信息
- 项目名称：
- 创建日期：
- 适用范围：全仓库 / 子模块（注明）
- 版本：v1

## 1. 项目概览与目标

## 2. 技术栈与关键依赖（含版本约束）

## 3. 目录结构与放置规则
- 根目录约定：
- 子模块/包：
- 资源/配置放置：

## 4. 代码规范与可测试性
- 引用/覆盖：codestyle（路径）
- 单元测试要求：
- 可测试性设计约束：

## 5. 数据与迁移
- 引用 data_rule（路径），差异点：
- 模型/迁移/回填策略：
- 软删/多租户/索引策略：

## 6. 接口契约真源
- OpenAPI 作为唯一真源（可选）：启用 / 不启用（若启用，写明具体约束）
- OpenAPI / GraphQL / proto / 事件 / 批处理 的真源文件与路径
- 变更同步要求：

## 7. 安全 / 隐私 / 合规（如有）

## 8. 构建 / 发布 / 环境
- 构建命令：
- 环境配置：
- 部署/发布流程：

## 9. 可观测性与回滚
- Feature flag / 配置开关：
- 双写/比对策略与指标：
- 日志/指标关注点：
- 回滚步骤：

## 10. 协作规范
- 分支策略：
- 提交信息规范：
- PR 模板 / 审批角色：

## 11. 测试准入
- 主流程 E2E（chrome MCP server 优先）：命令/脚本
- 单元测试：命令
- 其他测试：集成/回归/安全（如有）

## 12. 未决问题
- Q1：
- ...
```

---

## 五、成功判定

- `constitution.md` 已生成并落盘至指定路径
- 如需项目级规则文件，已生成/更新并在宪法中记录路径与差异
- 关键约束可被后续工作流引用（new_feature/upgrade_feature/bugfix/tech_modify 等）
- 测试准入明确：主流程 E2E（chrome MCP server 优先）+ 全部单元测试通过为默认通过线
